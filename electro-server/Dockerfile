
#Stage 1: Build Spring Boot jar
FROM maven:3.9.6-eclipse-temurin-11 AS build

# ƒê·∫∑t th∆∞ m·ª•c l√†m vi·ªác trong container
WORKDIR /app

# Sao ch√©p to√†n b·ªô source code v√†o container
COPY . .

# Build project (b·ªè qua test ƒë·ªÉ build nhanh h∆°n)
RUN mvn clean package -DskipTests


# üöÄ Stage 2: Run Spring Boot app
FROM openjdk:11-jdk-slim

# C√†i ƒë·∫∑t g√≥i ph·ª• thu·ªôc t·ªëi thi·ªÉu
RUN apt-get update \
    && apt-get install -y --no-install-recommends netcat locales \
    && apt-get clean \
    && locale-gen C.UTF-8

# ƒê·∫∑t th∆∞ m·ª•c l√†m vi·ªác m·∫∑c ƒë·ªãnh
WORKDIR /electro-server

# Sao ch√©p file .jar ƒë√£ build t·ª´ stage 1 sang
COPY --from=build /app/target/electro-0.0.1-SNAPSHOT.jar /electro-server/

# Thi·∫øt l·∫≠p ng√¥n ng·ªØ v√† locale
ENV LANG=C.UTF-8
ENV LC_ALL=C.UTF-8

# M·ªü port cho ·ª©ng d·ª•ng Spring Boot
EXPOSE 8085

# L·ªánh kh·ªüi ch·∫°y ·ª©ng d·ª•ng
ENTRYPOINT ["java", "-jar", "electro-0.0.1-SNAPSHOT.jar"]
